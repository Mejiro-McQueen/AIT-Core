#!/usr/bin/env python

import fcntl
import os
import sys
import argparse
import traceback
from bifrost.services.core.launcher import Launcher

def running():
    lock_file = os.open("/tmp/bifrost_launch_services.lock", os.O_WRONLY | os.O_CREAT)
    try:
        fcntl.lockf(lock_file, fcntl.LOCK_EX | fcntl.LOCK_NB)
        already_running = False
    except IOError:
        already_running = True
    return already_running


def main():
    ap = argparse.ArgumentParser(
        description=__doc__, formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )
    args = ap.parse_args()  # noqa

    if running():
        print("An instance of Bifrost is already running or could not obtain /tmp/bifrost_launch_services.lock flock.")
        sys.exit(-1)

    try:
        print("Starting Bifrost GDS")
        print("""""")
        service = Launcher()
    except Exception as e:
        print(e)


if __name__ == "__main__":
    main()
